(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[76],{63:(e,t,s)=>{"use strict";var a=s(7260);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})},7411:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var a=s(5155),r=s(2115),i=s(63);function n(){let e=(0,i.useRouter)(),t=(0,i.useParams)().id,[s,n]=(0,r.useState)(null),[l,o]=(0,r.useState)([]),[d,c]=(0,r.useState)(!0),[m,x]=(0,r.useState)(!1),[u,g]=(0,r.useState)(""),[h,p]=(0,r.useState)(!1),[b,j]=(0,r.useState)("CHARGE"),[y,N]=(0,r.useState)(""),[f,v]=(0,r.useState)(""),[D,C]=(0,r.useState)("");(0,r.useEffect)(()=>{let t=localStorage.getItem("user");if(!t)return void e.push("/login");C(JSON.parse(t).storeId),w()},[t]);let w=async()=>{try{let[s,a]=await Promise.all([fetch("/api/clients/".concat(t)),fetch("/api/clients/".concat(t,"/fiados"))]);if(s.ok&&a.ok){let e=await s.json(),t=await a.json();n(e),o(t)}else 401===s.status&&e.push("/login")}catch(e){console.error("Error:",e)}finally{c(!1)}},S=async e=>{e.preventDefault(),g(""),x(!0);try{let e=await fetch("/api/fiados",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientId:t,storeId:D,type:b,amount:parseFloat(y),description:f})}),s=await e.json();e.ok?(N(""),v(""),p(!1),w()):g(s.error||"Error al guardar")}catch(e){console.error("Error:",e),g("Error de conexi\xf3n")}finally{x(!1)}};return d?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Cargando..."})]})}):s?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white shadow",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"KOLMA2"}),(0,a.jsx)("button",{onClick:()=>e.push("/dashboard/clients"),className:"text-sm text-gray-600 hover:text-gray-900",children:"← Clientes"})]})})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,a.jsx)("div",{className:"flex justify-between items-start mb-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:s.name}),(0,a.jsxs)("p",{className:"text-gray-600 mt-1",children:["\uD83D\uDCDE ",s.phone]}),s.neighborhood&&(0,a.jsxs)("p",{className:"text-gray-600",children:["\uD83D\uDCCD ",s.neighborhood]}),s.address&&(0,a.jsx)("p",{className:"text-gray-600 text-sm mt-1",children:s.address})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-gray-200",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Balance Actual"}),(0,a.jsxs)("p",{className:"text-2xl font-bold ".concat((s.currentDebt||0)>0?"text-red-600":"text-green-600"),children:["RD$ ",(s.currentDebt||0).toLocaleString("es-DO",{minimumFractionDigits:2})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"L\xedmite de Cr\xe9dito"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["RD$ ",(s.creditLimit||0).toLocaleString("es-DO",{minimumFractionDigits:2})]})]})]}),s.notes&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Notas:"}),(0,a.jsx)("p",{className:"text-gray-900 mt-1",children:s.notes})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,a.jsx)("button",{onClick:()=>{j("CHARGE"),p(!0),g("")},className:"bg-orange-600 text-white py-3 rounded-lg font-medium hover:bg-orange-700 transition-colors",children:"\uD83D\uDCB0 Apuntar Fiado"}),(0,a.jsx)("button",{onClick:()=>{j("PAYMENT"),p(!0),g("")},className:"bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700 transition-colors",children:"\uD83D\uDCB5 Registrar Pago"})]}),h&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"CHARGE"===b?"\uD83D\uDCB0 Nuevo Fiado":"\uD83D\uDCB5 Registrar Pago"}),u&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg mb-4",children:u}),(0,a.jsxs)("form",{onSubmit:S,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Monto (RD$)"}),(0,a.jsx)("input",{type:"number",step:"0.01",value:y,onChange:e=>N(e.target.value),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"0.00"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descripci\xf3n"}),(0,a.jsx)("input",{type:"text",value:f,onChange:e=>v(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Arroz, aceite..."})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("button",{type:"submit",disabled:m,className:"flex-1 bg-indigo-600 text-white py-3 rounded-lg font-medium hover:bg-indigo-700 disabled:opacity-50 transition-colors",children:m?"Guardando...":"Guardar"}),(0,a.jsx)("button",{type:"button",onClick:()=>p(!1),className:"px-6 py-3 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"\uD83D\uDCCB Historial de Fiados"}),0===l.length?(0,a.jsx)("p",{className:"text-center text-gray-500 py-8",children:"No hay movimientos a\xfan"}):(0,a.jsx)("div",{className:"space-y-3",children:l.map(e=>(0,a.jsx)("div",{className:"p-4 rounded-lg ".concat("CHARGE"===e.type?"bg-red-50":"bg-green-50"),children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"CHARGE"===e.type?"\uD83D\uDCE4 Cargo":"\uD83D\uDCE5 Pago"}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:new Date(e.createdAt).toLocaleDateString("es-DO",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-lg font-bold ".concat("CHARGE"===e.type?"text-red-600":"text-green-600"),children:["CHARGE"===e.type?"+":"-","RD$ ",(e.amount||0).toLocaleString("es-DO",{minimumFractionDigits:2})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Balance: RD$ ",(e.balance||0).toLocaleString("es-DO",{minimumFractionDigits:2})]})]})]})},e.id))})]})]})]}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-xl text-gray-600",children:"Cliente no encontrado"}),(0,a.jsx)("button",{onClick:()=>e.push("/dashboard/clients"),className:"mt-4 text-indigo-600 hover:text-indigo-700",children:"← Volver a clientes"})]})})}},9296:(e,t,s)=>{Promise.resolve().then(s.bind(s,7411))}},e=>{e.O(0,[441,255,358],()=>e(e.s=9296)),_N_E=e.O()}]);